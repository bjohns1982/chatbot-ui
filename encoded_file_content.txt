aW1wb3J0ICRSZWZQYXJzZXIgZnJvbSAiQGFwaWRldnRvb2xzL2pzb24tc2NoZW1hLXJlZi1wYXJz
ZXIiCgppbnRlcmZhY2UgT3BlbkFQSURhdGEgewogIGluZm86IHsKICAgIHRpdGxlOiBzdHJpbmcK
ICAgIGRlc2NyaXB0aW9uOiBzdHJpbmcKICAgIHNlcnZlcjogc3RyaW5nCiAgfQogIHJvdXRlczog
ewogICAgcGF0aDogc3RyaW5nCiAgICBtZXRob2Q6IHN0cmluZwogICAgb3BlcmF0aW9uSWQ6IHN0
cmluZwogICAgcmVxdWVzdEluQm9keT86IGJvb2xlYW4KICB9W10KICBmdW5jdGlvbnM6IGFueQp9
CgpleHBvcnQgY29uc3QgdmFsaWRhdGVPcGVuQVBJID0gYXN5bmMgKG9wZW5hcGlTcGVjOiBhbnkp
ID0+IHsKICBpZiAoIW9wZW5hcGlTcGVjLmluZm8pIHsKICAgIHRocm93IG5ldyBFcnJvcigiKCdp
bmZvJyk6IGZpZWxkIHJlcXVpcmVkIikKICB9CgogIGlmICghb3BlbmFwaVNwZWMuaW5mby50aXRs
ZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCIoJ2luZm8nLCAndGl0bGUnKTogZmllbGQgcmVxdWly
ZWQiKQogIH0KCiAgaWYgKCFvcGVuYXBpU3BlYy5pbmZvLnZlcnNpb24pIHsKICAgIHRocm93IG5l
dyBFcnJvcigiKCdpbmZvJywgJ3ZlcnNpb24nKTogZmllbGQgcmVxdWlyZWQiKQogIH0KCiAgaWYg
KAogICAgIW9wZW5hcGlTcGVjLnNlcnZlcnMgfHwKICAgICFvcGVuYXBpU3BlYy5zZXJ2ZXJzLmxl
bmd0aCB8fAogICAgIW9wZW5hcGlTcGVjLnNlcnZlcnNbMF0udXJsCiAgKSB7CiAgICB0aHJvdyBu
ZXcgRXJyb3IoIkNvdWxkIG5vdCBmaW5kIGEgdmFsaWQgVVJMIGluIGBzZXJ2ZXJzYCIpCiAgfQoK
ICBpZiAoIW9wZW5hcGlTcGVjLnBhdGhzIHx8IE9iamVjdC5rZXlzKG9wZW5hcGlTcGVjLnBhdGhz
KS5sZW5ndGggPT09IDApIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm8gcGF0aHMgZm91bmQgaW4g
dGhlIE9wZW5BUEkgc3BlYyIpCiAgfQoKICBPYmplY3Qua2V5cyhvcGVuYXBpU3BlYy5wYXRocyku
Zm9yRWFjaChwYXRoID0+IHsKICAgIGlmICghcGF0aC5zdGFydHNXaXRoKCIvIikpIHsKICAgICAg
dGhyb3cgbmV3IEVycm9yKGBQYXRoICR7cGF0aH0gZG9lcyBub3Qgc3RhcnQgd2l0aCBhIHNsYXNo
OyBza2lwcGluZ2ApCiAgICB9CiAgfSkKCiAgaWYgKAogICAgT2JqZWN0LnZhbHVlcyhvcGVuYXBp
U3BlYy5wYXRocykuc29tZSgobWV0aG9kczogYW55KSA9PgogICAgICBPYmplY3QudmFsdWVzKG1l
dGhvZHMpLnNvbWUoKHNwZWM6IGFueSkgPT4gIXNwZWMub3BlcmF0aW9uSWQpCiAgICApCiAgKSB7
CiAgICB0aHJvdyBuZXcgRXJyb3IoIlNvbWUgbWV0aG9kcyBhcmUgbWlzc2luZyBvcGVyYXRpb25J
ZCIpCiAgfQoKICBpZiAoCiAgICBPYmplY3QudmFsdWVzKG9wZW5hcGlTcGVjLnBhdGhzKS5zb21l
KChtZXRob2RzOiBhbnkpID0+CiAgICAgIE9iamVjdC52YWx1ZXMobWV0aG9kcykuc29tZSgKICAg
ICAgICAoc3BlYzogYW55KSA9PiBzcGVjLnJlcXVlc3RCb2R5ICYmICFzcGVjLnJlcXVlc3RCb2R5
LmNvbnRlbnQKICAgICAgKQogICAgKQogICkgewogICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAi
U29tZSBtZXRob2RzIHdpdGggYSByZXF1ZXN0Qm9keSBhcmUgbWlzc2luZyByZXF1ZXN0Qm9keS5j
b250ZW50IgogICAgKQogIH0KCiAgaWYgKAogICAgT2JqZWN0LnZhbHVlcyhvcGVuYXBpU3BlYy5w
YXRocykuc29tZSgobWV0aG9kczogYW55KSA9PgogICAgICBPYmplY3QudmFsdWVzKG1ldGhvZHMp
LnNvbWUoKHNwZWM6IGFueSkgPT4gewogICAgICAgIGlmIChzcGVjLnJlcXVlc3RCb2R5Py5jb250
ZW50Py5bImFwcGxpY2F0aW9uL2pzb24iXT8uc2NoZW1hKSB7CiAgICAgICAgICBpZiAoCiAgICAg
ICAgICAgICFzcGVjLnJlcXVlc3RCb2R5LmNvbnRlbnRbImFwcGxpY2F0aW9uL2pzb24iXS5zY2hl
bWEucHJvcGVydGllcyB8fAogICAgICAgICAgICBPYmplY3Qua2V5cyhzcGVjLnJlcXVlc3RCb2R5
LmNvbnRlbnRbImFwcGxpY2F0aW9uL2pzb24iXS5zY2hlbWEpCiAgICAgICAgICAgICAgLmxlbmd0
aCA9PT0gMAogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAg
ICAgICAgICBgSW4gY29udGV4dD0oJ3BhdGhzJywgJyR7T2JqZWN0LmtleXMobWV0aG9kcylbMF19
JywgJyR7CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzcGVjKVswXQogICAgICAgICAgICAg
IH0nLCAncmVxdWVzdEJvZHknLCAnY29udGVudCcsICdhcHBsaWNhdGlvbi9qc29uJywgJ3NjaGVt
YScpLCBvYmplY3Qgc2NoZW1hIG1pc3NpbmcgcHJvcGVydGllc2AKICAgICAgICAgICAgKQogICAg
ICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgICkKICApIHsKICAgIHRocm93IG5ldyBFcnJv
cigiU29tZSBvYmplY3Qgc2NoZW1hcyBhcmUgbWlzc2luZyBwcm9wZXJ0aWVzIikKICB9Cn0KCmV4
cG9ydCBjb25zdCBvcGVuYXBpVG9GdW5jdGlvbnMgPSBhc3luYyAoCiAgb3BlbmFwaVNwZWM6IGFu
eQopOiBQcm9taXNlPE9wZW5BUElEYXRhPiA9PiB7CiAgY29uc3QgZnVuY3Rpb25zOiBhbnlbXSA9
IFtdIC8vIERlZmluZSBhIHByb3BlciB0eXBlIGZvciBmdW5jdGlvbiBvYmplY3RzCiAgY29uc3Qg
cm91dGVzOiB7CiAgICBwYXRoOiBzdHJpbmcKICAgIG1ldGhvZDogc3RyaW5nCiAgICBvcGVyYXRp
b25JZDogc3RyaW5nCiAgICByZXF1ZXN0SW5Cb2R5PzogYm9vbGVhbiAvLyBBZGQgYSBmbGFnIHRv
IGluZGljYXRlIGlmIHRoZSByZXF1ZXN0IHNob3VsZCBiZSBpbiB0aGUgYm9keQogIH1bXSA9IFtd
CgogIGZvciAoY29uc3QgW3BhdGgsIG1ldGhvZHNdIG9mIE9iamVjdC5lbnRyaWVzKG9wZW5hcGlT
cGVjLnBhdGhzKSkgewogICAgaWYgKHR5cGVvZiBtZXRob2RzICE9PSAib2JqZWN0IiB8fCBtZXRo
b2RzID09PSBudWxsKSB7CiAgICAgIGNvbnRpbnVlCiAgICB9CgogICAgZm9yIChjb25zdCBbbWV0
aG9kLCBzcGVjV2l0aFJlZl0gb2YgT2JqZWN0LmVudHJpZXMoCiAgICAgIG1ldGhvZHMgYXMgUmVj
b3JkPHN0cmluZywgYW55PgogICAgKSkgewogICAgICBjb25zdCBzcGVjOiBhbnkgPSBhd2FpdCAk
UmVmUGFyc2VyLmRlcmVmZXJlbmNlKHNwZWNXaXRoUmVmKQogICAgICBjb25zdCBmdW5jdGlvbk5h
bWUgPSBzcGVjLm9wZXJhdGlvbklkCiAgICAgIGNvbnN0IGRlc2MgPSBzcGVjLmRlc2NyaXB0aW9u
IHx8IHNwZWMuc3VtbWFyeSB8fCAiIgoKICAgICAgY29uc3Qgc2NoZW1hOiB7IHR5cGU6IHN0cmlu
ZzsgcHJvcGVydGllczogYW55OyByZXF1aXJlZD86IHN0cmluZ1tdIH0gPSB7CiAgICAgICAgdHlw
ZTogIm9iamVjdCIsCiAgICAgICAgcHJvcGVydGllczoge30KICAgICAgfQoKICAgICAgY29uc3Qg
cmVxQm9keSA9IHNwZWMucmVxdWVzdEJvZHk/LmNvbnRlbnQ/LlsiYXBwbGljYXRpb24vanNvbiJd
Py5zY2hlbWEKICAgICAgaWYgKHJlcUJvZHkpIHsKICAgICAgICBzY2hlbWEucHJvcGVydGllcy5y
ZXF1ZXN0Qm9keSA9IHJlcUJvZHkKICAgICAgfQoKICAgICAgY29uc3QgcGFyYW1zID0gc3BlYy5w
YXJhbWV0ZXJzIHx8IFtdCiAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMCkgewogICAgICAgIGNv
bnN0IHBhcmFtUHJvcGVydGllcyA9IHBhcmFtcy5yZWR1Y2UoKGFjYzogYW55LCBwYXJhbTogYW55
KSA9PiB7CiAgICAgICAgICBpZiAocGFyYW0uc2NoZW1hKSB7CiAgICAgICAgICAgIGFjY1twYXJh
bS5uYW1lXSA9IHBhcmFtLnNjaGVtYQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFjYwog
ICAgICAgIH0sIHt9KQoKICAgICAgICBzY2hlbWEucHJvcGVydGllcy5wYXJhbWV0ZXJzID0gewog
ICAgICAgICAgdHlwZTogIm9iamVjdCIsCiAgICAgICAgICBwcm9wZXJ0aWVzOiBwYXJhbVByb3Bl
cnRpZXMKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9ucy5wdXNoKHsKICAgICAgICB0
eXBlOiAiZnVuY3Rpb24iLAogICAgICAgIGZ1bmN0aW9uOiB7CiAgICAgICAgICBuYW1lOiBmdW5j
dGlvbk5hbWUsCiAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzYywKICAgICAgICAgIHBhcmFtZXRl
cnM6IHNjaGVtYQogICAgICAgIH0KICAgICAgfSkKCiAgICAgIC8vIERldGVybWluZSBpZiB0aGUg
cmVxdWVzdCBzaG91bGQgYmUgaW4gdGhlIGJvZHkgYmFzZWQgb24gdGhlIHByZXNlbmNlIG9mIHJl
cXVlc3RCb2R5CiAgICAgIGNvbnN0IHJlcXVlc3RJbkJvZHkgPSAhIXNwZWMucmVxdWVzdEJvZHkK
CiAgICAgIHJvdXRlcy5wdXNoKHsKICAgICAgICBwYXRoLAogICAgICAgIG1ldGhvZCwKICAgICAg
ICBvcGVyYXRpb25JZDogZnVuY3Rpb25OYW1lLAogICAgICAgIHJlcXVlc3RJbkJvZHkgLy8gSW5j
bHVkZSB0aGlzIGZsYWcgaW4gdGhlIHJvdXRlIGluZm9ybWF0aW9uCiAgICAgIH0pCiAgICB9CiAg
fQoKICByZXR1cm4gewogICAgaW5mbzogewogICAgICB0aXRsZTogb3BlbmFwaVNwZWMuaW5mby50
aXRsZSwKICAgICAgZGVzY3JpcHRpb246IG9wZW5hcGlTcGVjLmluZm8uZGVzY3JpcHRpb24sCiAg
ICAgIHNlcnZlcjogb3BlbmFwaVNwZWMuc2VydmVyc1swXS51cmwKICAgIH0sCiAgICByb3V0ZXMs
CiAgICBmdW5jdGlvbnMKICB9Cn0K
